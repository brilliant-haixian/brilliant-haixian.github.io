<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<link rel="stylesheet" type="text/css" href="css/custom.css">
<link rel="stylesheet" href="css/style.css">
</head>

<!--tab-->
	<script src="js/prefixfree.min.js"></script>
	<script src="js/jquery-1.11.0.min.js" type="text/javascript"></script>
	<script type="text/javascript" src="js/jquery-tab.js"></script>
	<script type="text/javascript">
		$(function(){
		// Calling the plugin
		$('.tab-group').tabify();
		})
	</script>	
<!--tab-->

<body style="background-color:white">

	<div id="root" >
		<script src='js/react.min.js'></script>
		<script src='js/react-dom.min.js'></script>
		<script src='js/anime.min.js'></script>
		<script  src="js/index.js">123</script>
	</div>
<br>

	<div class="nav">
		<a href="../index.html">首页</a>&nbsp&nbsp
		<a href="#" style="color:red">语言+代码</a>&nbsp&nbsp
		<a href="../network/index.html">网络配置</a>&nbsp&nbsp
		<a href="../gain/">编程心得</a>&nbsp&nbsp
		<a href="../other/">杂谈</a>
	</div>

<hr>
	<div style="width:720px;height:150px;margin:20px auto;text-align:center">
	<div class="fivey"><img src="images/a1.jpg" onmousemove="this.src='images/a11.jpg'"onmouseout="this.src='images/a1.jpg'" width="100px"style="margin:auto">Android</div>
	<div class="fivey"><img src="images/a2.jpg" onmousemove="this.src='images/a22.jpg'"onmouseout="this.src='images/a2.jpg'" width="100px"style="margin:auto">C++</div>
	<div class="fivey"><img src="images/a3.jpg" onmousemove="this.src='images/a33.jpg'"onmouseout="this.src='images/a3.jpg'" width="100px"style="margin:auto">HTML</div>
	<div class="fivey"><img src="images/a4.jpg" onmousemove="this.src='images/a44.jpg'"onmouseout="this.src='images/a4.jpg'" width="100px"style="margin:auto">java</div>
	
  </div>
  <hr color="#d5d5d5">

	 
<div class="htmleaf-container" >
	<div class="container">
	  <div class="tab-group">

<section id="tab1" title="HTML"> <!--html-->
			<div class="art">
			<div class="word">
				<img src="images/slide-4.jpg" >
				<a href=""><h3 >jQuery商城常用左侧悬浮导航定位代码</h3></a>
				<p >  jQuery商城常用左侧悬浮导航定位代码<br>
模拟商城左侧定位滚动导航栏，方便在使用途中自动调出，可以快速导航和找到自己的浏览位置，方便用户，增强用户体验，有利于用户的信息的即使访问和获取
使用教程：<br>


				 </p>
			</div>
		</div>
<hr>
		<div class="art">
			<div class="word">
				<img src="images/slide-5.jpg" >
				<a href=""><h3 >mac文档编辑器</h3></a>
				<p >  mac文档编辑器-卡<br>
模拟mac文档编辑样式，在windows操作平台也可以体验os操作系统，增强用户体验，方便在使用过程中信息的修改和使用，可以快速修改找自己对文档的编辑和增删改查，有利于方便用户，增强用户体验，有利于用户的信息的即使访问和获取
使用教程：<br>


				 </p>
			</div>
		</div>
<hr>
</section>       <!--html-->

<section id="tab2" title="Android">  <!--android-->
		 <div class="art">
			<div class="word">
				<img src="images/slide-1.jpg" >
				<a href=""><h3 >Android_API中文合集</h3></a>
				<p >  【Android中文API官方网站：www.android-doc.com】<br>

    1. 本资料为Android中文API合集，凝聚了各方网友、Android大神以及翻译大神的力量。<br>
    2. 他们日夜不辞辛苦，上班翻译，下班翻译，吃饭睡觉也翻译，不图酬劳，不畏艰辛，只为了分享并同时巩固自己的知识与经验。<br>
    3. 为了不辜负他们的心血，请仔细学习与拜读
				 </p>
			</div>
		</div>
<hr>
		<div class="art">
			<div class="word">
				<img src="images/slide-3.jpg" >
				<a href=""><h3 >安卓无线点餐系统</h3></a>
				<p >  基于Android的无线点餐系统（服务器+客户端+数据库）<br>
Codeblocks（强力推荐）： 功能比较强大的 c/c++ IDE，有着不错的智能提示，第一次用的时候，才发现原来编程可以这样舒服。下载地址：http://rj.baidu.com/soft/detail/16711.html
使用教程：CodeBlocks的入门使用教程 - 编程少年<br>
链接：https://www.zhihu.com/question/25842010/answer/236780117

				 </p>
			</div>
		</div>
<hr>
</section>       <!--android-->

<section id="tab3" title="Java-game">  <!--java-->
		 <div class="art">
			<div class="word">
				<img src="images/slide-3.jpg" >
				<a href=""><h3 >Android游戏源码简单双人对战五子棋源码</h3></a>
				<p >  
本游戏是一个简单的安卓两人对战五子棋游戏源码，方便没有棋盘的时候跟朋友消遣。不需要联机，
直接在一个棋盘上下，我的手机分辨率小点，所以游戏里面的棋盘显示不开，有大分辨率手机或者
平板的朋友可以测试一下，当然只做棋盘可以把上面的我的五子棋那几个字去掉，腾出上面的空间来干脆完全把手机屏幕变成一个棋盘就好了。游戏只用了三个java文件完成，算法部分有详细的中文注释，编码GBK 默认编译版本4.4.2

				 </p>
			</div>
		</div>
<hr>
		<div class="art">
			<div class="word">
				<img src="images/slide-1.jpg" >
				<a href=""><h3 >Android游戏源码经典游戏别踩白块钢琴块源码</h3></a>
				<p >   本项目是一个基于安卓OGEngine引擎的别踩白块(也叫黑白块或者钢琴块)的游戏源码，别踩白块是一款非常耐玩的休闲益智游戏，别踩白块儿，这就是这个游戏唯一的一个规则，代码有大量详细的中文注释，游戏试玩了一下很流畅和原版没有什么区别不过只有经典模式，接力和急速没有，需要的朋友可以下载学习一下，项目编码UTF-8默认编译版本2.3.3

				 </p>
			</div>
		</div>
<hr>
</section>             <!--java-->

<section id="tab4" title="c-game">  <!--c-->
		 <div class="art">
			<div class="word">
				<img src="../images/watch1.jpg" >
				<a href=""><h3 >飞行射击游戏源码</h3></a>
				<p >   Dev c++：这个IDE是windows环境下的，操作简单，功能也不弱，适合新手使用。<br>
Codeblocks（强力推荐）： 功能比较强大的 c/c++ IDE，有着不错的智能提示，第一次用的时候，才发现原来编程可以这样舒服。下载地址：http://rj.baidu.com/soft/detail/16711.html
使用教程：CodeBlocks的入门使用教程 - 编程少年<br>
链接：https://www.zhihu.com/question/25842010/answer/236780117

				 </p>
			</div>
		</div>
<hr>
		<div class="art">
			<div class="word">
				<img src="../images/jq1.jpg" >
				<a href=""><h3 >坦克战斗源码</h3></a>
				<p >   Dev c++：这个IDE是windows环境下的，操作简单，功能也不弱，适合新手使用。<br>
Codeblocks（强力推荐）： 功能比较强大的 c/c++ IDE，有着不错的智能提示，第一次用的时候，才发现原来编程可以这样舒服。下载地址：http://rj.baidu.com/soft/detail/16711.html
使用教程：CodeBlocks的入门使用教程 - 编程少年<br>
链接：https://www.zhihu.com/question/25842010/answer/236780117

				 </p>
			</div>
		</div>
<hr>
</section>              <!--c-->
		  
<section id="tab5" title="sql">  <!--c-->
	
create table #test (FCUSTID nvarchar(255),CustNumber nvarchar(255),CustName nvarchar(255),Fdate nvarchar(255),ArBillNo nvarchar(255),fremark nvarchar(255),FMATERIALID nvarchar(255),
MaterialNumber nvarchar(255),MaterialName nvarchar(255),FModel nvarchar(255),FSALQTY float,FunitName nvarchar(255),FTAXPRICE float,FRECEIVEAMOUNT float,FPAYAMOUNTFOR float,Ebalance float,sortid nvarchar(255))
insert into #test (FCUSTID ,CustNumber ,CustName ,Fdate ,ArBillNo ,fremark,FMATERIALID,MaterialNumber,MaterialName,FModel,FSALQTY,FunitName,FTAXPRICE ,FRECEIVEAMOUNT )
(SELECT  cid,   cnumb,cname, CONVERT(VARCHAR(19),FDATE,102), T.FBILLNO ,t.FREMARK,wid,wnum,wname, t.FSPECIFICATION ,  round (sum (qty),2) as qty ,danwei ,FTAXPRICE,sum(FRECEIVEAMOUNT )FROM (  
select t0.FCUSTOMERID as cid,tn.FNUMBER as cnumb,tk.FNAME as cname, t0.fdate , T0.FBILLNO ,t0.FREMARK,tm.FMATERIALID as wid,tm.FNUMBER as wnum,t1.FNAME as wname, t1.FSPECIFICATION , t3.FSALQTY QTY  , tw1.FNAME as danwei,t4.FTAXPRICE,t3.FSALQTY*t4.FTAXPRICE as FRECEIVEAMOUNT 
	from t_AR_receivable t0 left join T_BD_CUSTOMER_L tk on (tk.FCUSTID= t0.FCUSTOMERID) left join T_BD_CUSTOMER tn on tn.fcustid = tk.fcustid left join t_AR_receivableEntry      t4  on(t4.fid = t0.fid) left join t_AR_receivableEntry_O       t3  on(t4.FENTRYID = t3.FENTRYID) left join T_BD_MATERIAL_L      t1  on(t4.FMATERIALID = t1.FMATERIALID)left join T_BD_MATERIAL tm on tm.FMATERIALID = t1.FMATERIALID left join 	T_BD_UNIT tw on (tw.FUNITID=t3.FSALUNITID)  left join T_BD_UNIT_L tw1 on (tw1.FUNITID = tw.FUNITID) 
	where  t0.FBILLTYPEID = '180ecd4afd5d44b5be78a6efe4a7e041' 	and fdate >='{2}' and fdate <='{3}' 
union all
select t0.FCUSTOMERID as cid,tn.FNUMBER as cnumb,tk.FNAME as cname, t0.fdate ,T0.FBILLNO ,t0.FREMARK, tm.FMATERIALID as wid,tm.FNUMBER as wnum,t1.FNAME as wname, t1.FSPECIFICATION ,round (te.FNOTAXAMOUNTFOR/te.FTAXPRICE,3) as  QTY ,   tw1.FNAME as danwei,te.FTAXPRICE,te.FNOTAXAMOUNTFOR as FRECEIVEAMOUNT 
	from T_AR_RECEIVABLE t0 left join T_BD_CUSTOMER_L tk on (tk.FCUSTID= t0.FCUSTOMERID)left join T_BD_CUSTOMER tn on tn.fcustid = tk.fcustid left join t_AR_receivableEntry  te  on(te.fid = t0.fid) left join T_BD_MATERIAL_L      t1  on(te.FMATERIALID = t1.FMATERIALID)left join T_BD_MATERIAL tm on tm.FMATERIALID = t1.FMATERIALID left join t_AR_receivableEntry_O       t3  on(te.FENTRYID = t3.FENTRYID) left join T_AR_RECEIVABLEENTRY_LK  arl on te.FENTRYID =  arl.FENTRYID and FSTABLENAME = 't_AR_receivableEntry'left join 	T_BD_UNIT tw on (tw.FUNITID=t3.FSALUNITID) left join T_BD_UNIT_L tw1 on (tw1.FUNITID = tw.FUNITID)
	where  t0.FBILLTYPEID = '5a41e09cdf400e' and fdate >='{2}' and fdate <='{3}' 
) 	
T
Where t.cname is not null  GROUP BY cid,cnumb,cname, CONVERT(VARCHAR(19),FDATE,102), wid,wnum,wname, T.FBILLNO ,t.FREMARK,t.FSPECIFICATION ,  danwei,t.FTAXPRICE
)

delete from #test where FunitName='打' or FunitName='Dozen'

create table #fbill(fbill1 nvarchar(255),fbill2 nvarchar(255))
insert into #fbill (fbill1,fbill2)
(select distinct t0.FBILLNO,t5.FBILLNO from  t_AR_receivable t0 
left join T_AR_RECEIVABLEENTRY t2 on t2.fid=t0.FID
left join T_AR_RECEIVABLEENTRY_LK t3 on t3.FENTRYID=t2.FENTRYID
left join T_AR_RECEIVABLEENTRY t4 on t4.FENTRYID=t3.FSID
left join  t_AR_receivable t5 on t4.FID = t5.FID
where t0.FBILLTYPEID = '5a41e09cdf400e' )

update #test set sortid = fbill2 from #test t1 left join #fbill t2 on t2.fbill1 = t1.ArBillNo 
update #test set sortid = ArBillNo where sortid is null
update #test set fsalqty =abs(fsalqty)                                  --数量取正
update #test set FTAXPRICE =  freceiveamount/FSALQTY where FSALQTY!=0    --+ -单价


--select * from #test order by CustName,MaterialName


create table #ar (FCUSTID nvarchar(255),CustNumber nvarchar(255),CustName nvarchar(255),Fdate nvarchar(255),ArBillNo nvarchar(255),fremark nvarchar(255),FMATERIALID nvarchar(255),
MaterialNumber nvarchar(255),MaterialName nvarchar(255),FModel nvarchar(255),FSALQTY float,FunitName nvarchar(255),FTAXPRICE float,FRECEIVEAMOUNT float,FPAYAMOUNTFOR float,
Ebalance float,sortid nvarchar(255))
insert into #ar (FCUSTID ,CustNumber ,CustName ,Fdate ,ArBillNo ,fremark,FMATERIALID,MaterialNumber,MaterialName,FModel,FSALQTY,FunitName,FTAXPRICE,FRECEIVEAMOUNT,FPAYAMOUNTFOR,Ebalance ,sortid )
(
	select * from #test where ArBillNo like 'ar%' 
)


create table #tj (FCUSTID nvarchar(255),CustNumber nvarchar(255),CustName nvarchar(255),Fdate nvarchar(255),ArBillNo nvarchar(255),fremark nvarchar(255),FMATERIALID nvarchar(255),
MaterialNumber nvarchar(255),MaterialName nvarchar(255),FModel nvarchar(255),FSALQTY float,FunitName nvarchar(255),FTAXPRICE float,FRECEIVEAMOUNT float,FPAYAMOUNTFOR float,Ebalance float,sortid nvarchar(255))
insert into #tj (FCUSTID ,CustNumber ,CustName ,Fdate ,ArBillNo ,fremark,FMATERIALID,MaterialNumber,MaterialName,FModel,FSALQTY,FunitName,FTAXPRICE,FRECEIVEAMOUNT,FPAYAMOUNTFOR,Ebalance ,sortid )
(
	select * from #test where ArBillNo like 'tj%' 
)

--select * from #ar  --16540

create table #artj (FCUSTID nvarchar(255),CustNumber nvarchar(255),CustName nvarchar(255),Fdate nvarchar(255),ArBillNo nvarchar(255),fremark nvarchar(255),FMATERIALID nvarchar(255),
MaterialNumber nvarchar(255),MaterialName nvarchar(255),FModel nvarchar(255),FSALQTY float,FunitName nvarchar(255),FTAXPRICE float,FRECEIVEAMOUNT float,FPAYAMOUNTFOR float,Ebalance float,sortid nvarchar(255),tjprice float,tjfre float,tjbill nvarchar(255))
insert into #artj (FCUSTID ,CustNumber ,CustName ,Fdate ,ArBillNo ,fremark,FMATERIALID,MaterialNumber,MaterialName,FModel,FSALQTY,FunitName,FTAXPRICE,FRECEIVEAMOUNT,FPAYAMOUNTFOR,Ebalance ,sortid,tjprice,tjfre,tjbill )
(
select ar.*,tj.FTAXPRICE,tj.FRECEIVEAMOUNT,tj.ArBillNo from #ar ar           --16614
left join #tj tj on ar.sortid =tj.sortid and ar.MaterialNumber =tj.MaterialNumber and ar.FSALQTY =tj.FSALQTY
)
create table #dandutj(FCUSTID nvarchar(255),CustNumber nvarchar(255),CustName nvarchar(255),Fdate nvarchar(255),ArBillNo nvarchar(255),fremark nvarchar(255),FMATERIALID nvarchar(255),
MaterialNumber nvarchar(255),MaterialName nvarchar(255),FModel nvarchar(255),FSALQTY float,FunitName nvarchar(255),FTAXPRICE float,FRECEIVEAMOUNT float,FPAYAMOUNTFOR float,Ebalance float,sortid nvarchar(255),tjprice float,tjfre float,tjbill nvarchar(255))
insert into #dandutj (FCUSTID ,CustNumber ,CustName ,Fdate ,ArBillNo ,fremark,FMATERIALID,MaterialNumber,MaterialName,FModel,FSALQTY,FunitName,FTAXPRICE,FRECEIVEAMOUNT,FPAYAMOUNTFOR,Ebalance ,sortid,tjprice,tjfre,tjbill )
(select * from #artj where  tjbill is not null)

create table #savedandutj(FCUSTID int,CustName nvarchar(255), Fdate datetime,ArBillNo nvarchar(255),fremark nvarchar(255),MaterialName nvarchar(255), fmodel nvarchar(255),FSALQTY float,funitname nvarchar(255),FTAXPRICE float,FRECEIVEAMOUNT float,FPAYAMOUNTFOR float,Ebalance float )
insert into #savedandutj(FCUSTID,CustName,Fdate,ArBillNo,fremark,MaterialName,fmodel,FSALQTY,funitname,FTAXPRICE,FRECEIVEAMOUNT,FPAYAMOUNTFOR,Ebalance)
(select tj.FCUSTID,tj.CustName,tj.Fdate,tj.ArBillNo,tj.fremark,tj.MaterialName,tj.FModel,tj.FSALQTY,tj.FunitName,tj.FTAXPRICE,tj.FRECEIVEAMOUNT,tj.FPAYAMOUNTFOR,tj.Ebalance from #tj tj   
left join #dandutj d on d.tjprice = tj.FTAXPRICE and d.tjfre =tj.FRECEIVEAMOUNT and tj.ArBillNo =d.tjbill
where d.ArBillNo is null)

--回位tj单
create table #yiyongtj (tjbill nvarchar(255))
insert into #yiyongtj(tjbill)
(
	select distinct tjbill from #artj  
)

--合并比较tj单
create table #hebingtj (FCUSTID nvarchar(255),CustNumber nvarchar(255),CustName nvarchar(255),Fdate nvarchar(255),ArBillNo nvarchar(255),fremark nvarchar(255),FMATERIALID nvarchar(255),
MaterialNumber nvarchar(255),MaterialName nvarchar(255),FModel nvarchar(255),FSALQTY float,FunitName nvarchar(255),FTAXPRICE float,FRECEIVEAMOUNT float,FPAYAMOUNTFOR float,Ebalance float,sortid nvarchar(255),tjbill nvarchar(255))
insert into #hebingtj (FCUSTID ,CustNumber ,CustName ,Fdate ,ArBillNo ,fremark,FMATERIALID,MaterialNumber,MaterialName,FModel,FSALQTY,FunitName,FTAXPRICE,FRECEIVEAMOUNT,FPAYAMOUNTFOR,Ebalance ,sortid ,tjbill )
(
	select * from #tj tj
	left join #yiyongtj yi on yi.tjbill =tj.ArBillNo
)

--单独行tj
create table #buhuiweitj (FCUSTID nvarchar(255),CustNumber nvarchar(255),CustName nvarchar(255),Fdate nvarchar(255),ArBillNo nvarchar(255),fremark nvarchar(255),FMATERIALID nvarchar(255),
MaterialNumber nvarchar(255),MaterialName nvarchar(255),FModel nvarchar(255),FSALQTY float,FunitName nvarchar(255),FTAXPRICE float,FRECEIVEAMOUNT float,FPAYAMOUNTFOR float,Ebalance float,sortid nvarchar(255),tjpri float,tjfre float)
insert into #buhuiweitj (FCUSTID ,CustNumber ,CustName ,Fdate ,ArBillNo ,fremark,FMATERIALID,MaterialNumber,MaterialName,FModel,FSALQTY,FunitName,FTAXPRICE,FRECEIVEAMOUNT,FPAYAMOUNTFOR,Ebalance ,sortid ,tjpri )
(
select * from #hebingtj where tjbill is null
)


--删除tj单号，方便二调单合并
alter table #artj drop column tjbill

--合并二调单
create table #huiweihebing (FCUSTID nvarchar(255),CustNumber nvarchar(255),CustName nvarchar(255),Fdate nvarchar(255),ArBillNo nvarchar(255),fremark nvarchar(255),FMATERIALID nvarchar(255),
MaterialNumber nvarchar(255),MaterialName nvarchar(255),FModel nvarchar(255),FSALQTY float,FunitName nvarchar(255),FTAXPRICE float,FRECEIVEAMOUNT float,FPAYAMOUNTFOR float,Ebalance float,sortid nvarchar(255),tjpri float,tjfre float)
insert into #huiweihebing (FCUSTID ,CustNumber ,CustName ,Fdate ,ArBillNo ,fremark,FMATERIALID,MaterialNumber,MaterialName,FModel,FSALQTY,FunitName,FTAXPRICE,FRECEIVEAMOUNT,FPAYAMOUNTFOR,Ebalance ,sortid ,tjpri,tjfre )
(
select FCUSTID ,CustNumber ,CustName ,Fdate ,ArBillNo ,fremark,FMATERIALID,MaterialNumber,MaterialName,FModel,FSALQTY,FunitName,FTAXPRICE,FRECEIVEAMOUNT,FPAYAMOUNTFOR,Ebalance ,sortid,sum(tjprice),sum(tjfre)  from #artj group by FCUSTID ,CustNumber ,CustName ,Fdate ,ArBillNo ,fremark,FMATERIALID,MaterialNumber,MaterialName,FModel,FSALQTY,FunitName,FTAXPRICE,FRECEIVEAMOUNT,FPAYAMOUNTFOR,Ebalance ,sortid 
)

--select * from #huiweihebing where  ArBillNo='AR00003295'

--自增字段，方便去重
create table #zizeng (FCUSTID nvarchar(255),CustNumber nvarchar(255),CustName nvarchar(255),Fdate nvarchar(255),ArBillNo nvarchar(255),fremark nvarchar(255),FMATERIALID nvarchar(255),
MaterialNumber nvarchar(255),MaterialName nvarchar(255),FModel nvarchar(255),FSALQTY float,FunitName nvarchar(255),FTAXPRICE float,FRECEIVEAMOUNT float,FPAYAMOUNTFOR float,Ebalance float,sortid nvarchar(255),tjpri float,tjfre float)
insert into #zizeng (FCUSTID ,CustNumber ,CustName ,Fdate ,ArBillNo ,fremark,FMATERIALID,MaterialNumber,MaterialName,FModel,FSALQTY,FunitName,FTAXPRICE,FRECEIVEAMOUNT,FPAYAMOUNTFOR,Ebalance ,sortid ,tjpri,tjfre )
(
select * from #huiweihebing where tjpri is not null
)

--存储自增
create table #savezizeng (FCUSTID nvarchar(255),CustNumber nvarchar(255),CustName nvarchar(255),Fdate nvarchar(255),ArBillNo nvarchar(255),fremark nvarchar(255),FMATERIALID nvarchar(255),
MaterialNumber nvarchar(255),MaterialName nvarchar(255),FModel nvarchar(255),FSALQTY float,FunitName nvarchar(255),FTAXPRICE float,FRECEIVEAMOUNT float,FPAYAMOUNTFOR float,Ebalance float,sortid nvarchar(255),tjpri float,tjfre float,sum int)
insert into #savezizeng (FCUSTID ,CustNumber ,CustName ,Fdate ,ArBillNo ,fremark,FMATERIALID,MaterialNumber,MaterialName,FModel,FSALQTY,FunitName,FTAXPRICE,FRECEIVEAMOUNT,FPAYAMOUNTFOR,Ebalance ,sortid ,tjpri,tjfre,sum )
(
select *,
row_number()over(partition by sortid,materialnumber,fsalqty order by getdate()) as num
from #zizeng
)


--更新非1 的单价，应收为0
update #savezizeng set tjpri=0 ,tjfre=0 where sum !=1
alter table #savezizeng drop column sum
delete from #huiweihebing where tjpri is not null
insert into #huiweihebing (FCUSTID ,CustNumber ,CustName ,Fdate ,ArBillNo ,fremark,FMATERIALID,MaterialNumber,MaterialName,FModel,FSALQTY,FunitName,FTAXPRICE,FRECEIVEAMOUNT,FPAYAMOUNTFOR,Ebalance ,sortid ,tjpri,tjfre )
(select * from #savezizeng)



update #huiweihebing set tjpri = 0 where tjpri is null
update #huiweihebing set tjfre = 0 where tjfre is null
update #huiweihebing set FTAXPRICE =FTAXPRICE+tjpri,FRECEIVEAMOUNT =FRECEIVEAMOUNT+tjfre

--select * from #huiweihebing where fremark ='期初余额'
create table #zhengchang(FCUSTID int,CustName nvarchar(255), Fdate datetime,ArBillNo nvarchar(255),fremark nvarchar(255),MaterialName nvarchar(255), fmodel nvarchar(255),FSALQTY float,funitname nvarchar(255),FTAXPRICE float,FRECEIVEAMOUNT float,FPAYAMOUNTFOR float,Ebalance float )
insert into #zhengchang(FCUSTID,CustName,Fdate,ArBillNo,fremark,MaterialName,fmodel,FSALQTY,funitname,FTAXPRICE,FRECEIVEAMOUNT,FPAYAMOUNTFOR,Ebalance)
(select FCUSTID,CustName,Fdate,ArBillNo,fremark,MaterialName, fmodel,FSALQTY,funitname,FTAXPRICE,FRECEIVEAMOUNT,FPAYAMOUNTFOR,Ebalance from #huiweihebing
union all
select ts.FCONTACTUNIT as FCUSTID,tk.FNAME as CustName, CONVERT(VARCHAR(19),ts.FDATE,102) as Fdate ,ts.FBILLNO as ArBillNo,ts.fremark,
'' as MaterialName, ''as fmodel,
0 as qty,''as funitname,
0 as FTAXPRICE,
0 as FRECEIVEAMOUNT, 
convert( decimal(18,2), ts.FRECEIVEAMOUNTFOR) as FPAYAMOUNTFOR,0 as ebalace
from T_AR_RECEIVEBILL   ts
left join T_BD_CUSTOMER_L tk on (tk.FCUSTID= ts.FCONTACTUNIT) 
where ts.fbilltypeid ='36cf265bd8c3452194ed9c83ec5e73d2'  and ts.FDATE>='{2}' and ts.FDATE<='{3}'
union all
(select tt.FCONTACTUNIT as cid,tk.FNAME as cname, CONVERT(VARCHAR(19),tt.FDATE,102) as Fdate ,tt.FBILLNO as fbillno,tt.FREMARK,
'' as wname,''as fmodel, 0 as QTY,''as funitname,0 as FTAXPRICE,0 as FRECEIVEAMOUNT, -(tt.FREFUNDTOTALAMOUNTFOR)  as FPAYAMOUNTFOR,0 as ebalace
from  T_AR_REFUNDBILL	tt	
left join T_BD_CUSTOMER_L tk on (tk.FCUSTID= tt.FCONTACTUNIT)
where tt.FBILLTYPEID ='ef06f87d394a462d9f96cb2397803372' and tt.FDATE>='{2}' and tt.FDATE<='{3}'
)
union all
select FCUSTID,CustName,Fdate,ArBillNo,fremark,MaterialName,FModel,FSALQTY,FunitName,FTAXPRICE,FRECEIVEAMOUNT,FPAYAMOUNTFOR,Ebalance from  #buhuiweitj
union all
select  * from #savedandutj
)




create table #qichu (fcustid nvarchar(255),fname nvarchar(250),fbeginbalancefor float, fdate1 nvarchar(255))
insert into #qichu (fcustid,fname,fbeginbalancefor ,fdate1)
(select   tk.FCUSTID,FNAME,qichu.FBEGINBALANCEFOR, CONVERT(VARCHAR(19),qichu.FSTARTDATE,102)  from  T_BD_CUSTOMER_L tk 
left join T_AR_CONTACTBAL qichu on (tk.FCUSTID= qichu.FCONTACTUNIT) 
where qichu.FSTARTDATE=qichu.FENDDATE and qichu.FSTARTDATE='2018-01-01 00:00:00.000')




 --不合并
 create table #buhebing 
 (cid int ,cname nvarchar(255),fdate datetime,fbillno nvarchar(255),wname nvarchar(255),
 qty float,ftaxprice float,freceiveamount float,fpayamountfor float ,ebalace float)
 insert into #buhebing(cid ,cname,fdate ,fbillno,wname,qty,ftaxprice,freceiveamount,fpayamountfor,ebalace)
 (
 select    --原单调价单不合并
	t0.FCUSTOMERID as cid,
	tk.FNAME as cname, 
	t0.fdate , 
	T0.FBILLNO ,
	t1.FNAME as wname, 
	t3.FSALQTY as QTY  , 
	t4.FTAXPRICE,
	fsalqty*ftaxprice as FRECEIVEAMOUNT,
	 0 as FPAYAMOUNTFOR,0 as ebalace
	from t_AR_receivable t0
	left join T_BD_CUSTOMER_L tk on (tk.FCUSTID= t0.FCUSTOMERID)
	left join T_BD_CUSTOMER tn on tn.fcustid = tk.fcustid
	left join t_AR_receivableEntry      t4  on(t4.fid = t0.fid) 
	left join t_AR_receivableEntry_O       t3  on(t4.FENTRYID = t3.FENTRYID) 
	left join T_BD_MATERIAL_L      t1  on(t4.FMATERIALID = t1.FMATERIALID)
	left join T_BD_MATERIAL tm on tm.FMATERIALID = t1.FMATERIALID
	left join 	T_BD_UNIT tw on (tw.FUNITID=t3.FSALUNITID)  
	left join T_BD_UNIT_L tw1 on (tw1.FUNITID = tw.FUNITID) 
	where  t0.FBILLTYPEID = '180ecd4afd5d44b5be78a6efe4a7e041'
union all
	select 
	
	t0.FCUSTOMERID as cid,
	tk.FNAME as cname, 
	t0.fdate ,
	T0.FBILLNO ,
	t1.FNAME as wname, 
	round (te.FNOTAXAMOUNTFOR/te.FTAXPRICE,1) as  QTY ,   
	te.FTAXPRICE,
	te.FNOTAXAMOUNTFOR as FRECEIVEAMOUNT,
	 0 as FPAYAMOUNTFOR,0 as ebalace
	from T_AR_RECEIVABLE t0
	left join T_BD_CUSTOMER_L tk on (tk.FCUSTID= t0.FCUSTOMERID)
	left join T_BD_CUSTOMER tn on tn.fcustid = tk.fcustid
	left join t_AR_receivableEntry  te  on(te.fid = t0.fid) 
	left join T_BD_MATERIAL_L      t1  on(te.FMATERIALID = t1.FMATERIALID)
	left join T_BD_MATERIAL tm on tm.FMATERIALID = t1.FMATERIALID
	left join t_AR_receivableEntry_O       t3  on(te.FENTRYID = t3.FENTRYID) 
	left join T_AR_RECEIVABLEENTRY_LK  arl on te.FENTRYID =  arl.FENTRYID and FSTABLENAME = 't_AR_receivableEntry'
	left join 	T_BD_UNIT tw on (tw.FUNITID=t3.FSALUNITID) 
	left join T_BD_UNIT_L tw1 on (tw1.FUNITID = tw.FUNITID)
	where  t0.FBILLTYPEID = '5a41e09cdf400e' 
  --原单调价单不合并 ts.FCONTACTUNIT  ts.FCONTACTUNIT

	union all --收款退款
select ts.FCONTACTUNIT as cid,tk.FNAME as cname, CONVERT(VARCHAR(19),ts.FDATE,102) as Fdate ,ts.FBILLNO as fbillno,
'' as wname, 
0 as qty,
0 as FTAXPRICE,
0 as FRECEIVEAMOUNT, 
convert( decimal(18,2), ts.FRECEIVEAMOUNTFOR) as FPAYAMOUNTFOR,0 as ebalace
from T_AR_RECEIVEBILL   ts
left join T_BD_CUSTOMER_L tk on (tk.FCUSTID= ts.FCONTACTUNIT) 
where ts.fbilltypeid ='36cf265bd8c3452194ed9c83ec5e73d2' 
union all
(select tt.FCONTACTUNIT as cid,tk.FNAME as cname, CONVERT(VARCHAR(19),tt.FDATE,102) as Fdate ,tt.FBILLNO as fbillno,
'' as wname,0 as QTY,0 as FTAXPRICE,0 as FRECEIVEAMOUNT, -(tt.FREFUNDTOTALAMOUNTFOR)  as FPAYAMOUNTFOR,0 as ebalace
from  T_AR_REFUNDBILL	tt	
left join T_BD_CUSTOMER_L tk on (tk.FCUSTID= tt.FCONTACTUNIT)
where tt.FBILLTYPEID ='ef06f87d394a462d9f96cb2397803372' 
)
	--收款退款
union all
select fcustid as cid,fname as cname, CONVERT(datetime,FDATE1,111)  as fdate,''as fbillno,'' as wname,0 as qty,0 as ftaxprice,0 as FRECEIVEAMOUNT,0 as FPAYAMOUNTFOR,
fbeginbalancefor as ebalace from #qichu

)

create table #saveqichu(custid int ,custname nvarchar(255),fdate datetime ,arbill nvarchar(255),fremark nvarchar(255),mater nvarchar(255),fmodel nvarchar(255),fsalqty float,funitname nvarchar(255),ftaxprice float,freceiveamount float,fpay float,ebalace float)
insert into #saveqichu(custid,custname,fdate,arbill,fremark,mater,fmodel,fsalqty,funitname,ftaxprice,freceiveamount,fpay,ebalace)
(select cid,cname as custname,CONVERT(datetime,'{2}'  /*{2}*/,    102)as fdate,''as arbillno,'期初余额'as fremark,''as materialname,''as fmodel,0as fsalqty,
  ''as funitname,0as ftaxprice,0as freceiveamount,0as fpayamountfor,sum(ebalace)+sum(freceiveamount)-sum(fpayamountfor)as ebalance
   from #buhebing 
   where fdate>='2018/1/1 0:00:00' and fdate<'{2}' --2018 {2}
   group by cname,cid
)

create table #guolvqichu (custid int ,custname nvarchar(255),fdate datetime ,arbill nvarchar(255),fremark nvarchar(255),mater nvarchar(255),fmodel nvarchar(255),fsalqty float,funitname nvarchar(255),ftaxprice float,freceiveamount float,fpay float,ebalace float)
insert into #guolvqichu(custid,custname,fdate,arbill,fremark,mater,fmodel,fsalqty,funitname,ftaxprice,freceiveamount,fpay,ebalace)
(select fcustid,fname,fdate1, ''as arbill ,''as fremark,''as mater,''as fmodel,''as fsalqty,''as funitname,''as ftaxprice,''as freceiveamount,''as fpay,fbeginbalancefor as ebalace from #qichu union 
select * from #saveqichu 
)
create table #saveguolv (custid int ,custname nvarchar(255),fdate datetime ,arbill nvarchar(255),fremark nvarchar(255),mater nvarchar(255),fmodel nvarchar(255),fsalqty float,funitname nvarchar(255),ftaxprice float,freceiveamount float,fpay float,ebalace float,num int)
insert into #saveguolv(custid,custname,fdate,arbill,fremark,mater,fmodel,fsalqty,funitname,ftaxprice,freceiveamount,fpay,ebalace,num)
(select *, row_number()over(partition by custid order by fdate desc) as num from #guolvqichu)


delete  from #saveguolv where fremark='' and num =2

create table #qichuzhengchang (custid int ,custname nvarchar(255),fdate datetime ,arbill nvarchar(255),fremark nvarchar(255),mater nvarchar(255),fmodel nvarchar(255),fsalqty float,funitname nvarchar(255),ftaxprice float,freceiveamount float,fpay float,ebalace decimal(18,2))
insert into #qichuzhengchang (custid,custname,fdate,arbill,fremark,mater,fmodel,fsalqty,funitname,ftaxprice,freceiveamount,fpay,ebalace)
(select custid,custname,fdate,arbill,fremark,mater,fmodel,fsalqty,funitname,ftaxprice,freceiveamount,fpay,ebalace from #saveguolv
union 
select * from #zhengchang
)
update #qichuzhengchang set fpay =0 where fpay is null
update #qichuzhengchang set ebalace =0 where ebalace is null


--期初+正常+合计
insert into #qichuzhengchang (custid,custname,fdate,arbill,fremark,mater,fmodel,fsalqty,funitname,ftaxprice,freceiveamount,fpay,ebalace)
(select custid,custname,'{3}'/*{3}*/as fdate,''as arbill,'合计'as fremark,''as mater,''as fmodel,''as fsalqty,''as funitname,''as ftaxprice,sum (freceiveamount) as freceiveamount ,sum(fpay) as fpay,sum(ebalace)+sum(freceiveamount)-sum(fpay)as ebalace from #qichuzhengchang  group by custid,custname 
)


create table #ora (forgid  decimal(18,2),fname nvarchar(255))   --天邦万豪
insert into #ora (forgid,fname)
(select distinct FORGID,FNAME from T_ORG_ORGANIZATIONS_L)

create table #bumen (fcustid nvarchar(255),fdatavalue nvarchar(255),fentryid nvarchar(255)) 
insert into #bumen (fcustid,fdatavalue,fentryid)
(select distinct tke.FCUSTID,tg.FDATAVALUE,tg.FENTRYID from T_BD_CUSTOMER tke
left join T_BAS_ASSISTANTDATAENTRY_L  tg on tke.FCOMPANYCLASSIFY =tg.FENTRYID and tg.FLOCALEID = 2052
)
--select * from #gong
create table #pianqu (fcustid nvarchar(255),fdateavalue nvarchar(255),fdatavalue nvarchar(255),fentryid1 nvarchar(255),fentryid2 nvarchar(255))
insert into #pianqu (fcustid,fdateavalue,fentryid1,fdatavalue,fentryid2)
(select distinct tbu.* ,tg.FDATAVALUE ,tg.FENTRYID from #bumen tbu
left join  T_BD_CUSTOMER tke on tke.FCUSTID = tbu.fcustid
left join T_BAS_ASSISTANTDATAENTRY_L tg on tg.FENTRYID =tke.FCOMPANYNATURE and tg.FLOCALEID = 2052)


create table #gong (fcustid nvarchar(255),fdateavalue nvarchar(255),fdatavalue nvarchar(255),gong nvarchar(255),fentryid1 nvarchar(255),fentryid2 nvarchar(255),fentryid3 nvarchar(255))
insert into #gong (fcustid,fdateavalue,fdatavalue,gong,fentryid1,fentryid2,fentryid3 )
(select distinct pian.fcustid,pian.fdateavalue,pian.fdatavalue ,tg.FDATAVALUE ,pian.fentryid1,pian.fentryid2,tg.FENTRYID from #pianqu pian
left join  T_BD_CUSTOMER tke on tke.FCUSTID = pian.fcustid
left join T_BAS_ASSISTANTDATAENTRY_L tg on tg.FENTRYID =tke.FCOMPANYSCALE and tg.FLOCALEID = 2052)


create table #test2( FCUSTID int,CustName nvarchar(255),Fdate nvarchar(255),ArBillNo nvarchar(255),fremark nvarchar(255),MaterialName nvarchar(255),FModel nvarchar(255),FSALQTY float,FunitName nvarchar(255),FTAXPRICE float,FRECEIVEAMOUNT float,FPAYAMOUNTFOR float,Ebalance float,fshortname nvarchar(255), FCOMPANYCLASSIFY nvarchar(255),FCOMPANYNATURE nvarchar(255),FCOMPANYSCALE nvarchar(255),fname nvarchar(255),sortid nvarchar(255), fdate1 datetime,gsid nvarchar(255),bmid nvarchar(255),pqid nvarchar(255),forid int)
insert into #test2(FCUSTID,CustName ,Fdate ,ArBillNo ,fremark,MaterialName,FModel,FSALQTY,FunitName,FTAXPRICE,FRECEIVEAMOUNT ,FPAYAMOUNTFOR ,Ebalance ,fshortname,FCOMPANYCLASSIFY,FCOMPANYNATURE,FCOMPANYSCALE,fname,sortid,fdate1,gsid,bmid,pqid,forid)
(
select  t7.custid,t7.custname,CONVERT(VARCHAR(19),FDATE,102),t7.arbill,t7.fremark,t7.mater,t7.fmodel,t7.fsalqty,t7.funitname,t7.ftaxprice,t7.freceiveamount,t7.fpay,t7.ebalace, t.fshortname,g.fdateavalue,g.fdatavalue ,g.gong,o.fname,''as sortid ,CONVERT(datetime,fdate,111),g.fentryid1,g.fentryid2,g.fentryid3,o.forgid from  #qichuzhengchang  t7
left join T_BD_CUSTOMER c on c.FCUSTID=t7.custid
left join #ora o on o.FORGID = c.FUSEORGID 
left join #gong g on g.fcustid =t7.custid 
left join   T_BD_CUSTOMER_L t on t.FCUSTID =t7.custid 
)


update #test2 set fremark ='期初余额' where ArBillNo ='' and fremark ='' 
update #test2 set sortid ='a' where fremark='期初余额'
update #test2 set sortid ='z' where fremark='合计'
update #test2 set sortid ='b' where fremark!='合计' and fremark!='期初余额'
update #test2 set FSALQTY = null where FSALQTY =0
update #test2 set FTAXPRICE = null where FTAXPRICE =0
update #test2 set FRECEIVEAMOUNT = null where FRECEIVEAMOUNT =0
update #test2 set FPAYAMOUNTFOR = null where FPAYAMOUNTFOR =0
update #test2 set Ebalance = null where Ebalance =0
update #test2 set FSALQTY = null where ArBillNo like 'tj%'




create table #noqichu (fcustid int, custname nvarchar(255))
insert into #noqichu (fcustid, custname)
(select FCUSTID, custname from #test2 where fremark='期初余额')

create table #allper (fcustid int, custname nvarchar(255))
insert into #allper (fcustid, custname)
(select distinct FCUSTID, custname from #test2 )

create table #noqichusave (fcustid int ,acustname nvarchar(255) ,bcustname nvarchar(255))
insert into #noqichusave(fcustid,acustname,bcustname)
(

select a.fcustid,a.custname, b.custname from #allper a
left join #noqichu b on a.FCUSTID=b.fcustid
)

insert into #test2(FCUSTID,CustName ,Fdate ,ArBillNo ,fremark,MaterialName,FModel,FSALQTY,FunitName,FTAXPRICE,FRECEIVEAMOUNT ,FPAYAMOUNTFOR ,Ebalance ,fshortname,FCOMPANYCLASSIFY,FCOMPANYNATURE,FCOMPANYSCALE,fname,sortid,fdate1,gsid,bmid,pqid,forid)
(
select fcustid,acustname ,''as fdate ,''as arbill,'期初余额' as fremark ,null as materialname,null as fmodel,null as fsalqty ,null as funitname,null ,null as fre,null as fpay ,'0'as eba,''as fsh,'','','','','','','','','','' from #noqichusave where bcustname is null
)

create table #oneqichu (fdate nvarchar(255))
insert into #oneqichu (fdate)
(
select distinct fdate from #test2  where fremark='期初余额' and #test2.Fdate !=''
)

update #test2 set #test2.fdate=#oneqichu.fdate from #test2,#oneqichu where fremark='期初余额' and #test2.Fdate =''








select * 
 ,
 ROW_NUMBER() OVER(ORDER BY CustName,sortid,fdate1) FIDENTITYID 
  into {1}
from #test2 



		 
</section>              <!--c-->
		
	  </div>
	</div>
</div>


 





</body>
</html>
